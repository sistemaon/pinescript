
# Time (_Tempo_)

## Quatro Refer√™ncias

Quatro refer√™ncias diferentes entram em jogo ao usar valores de data e hora no Pine Script:

1. __Fuso hor√°rio UTC__: O formato nativo para valores de tempo no Pine Script √© o __tempo Unix em milissegundos__. O tempo Unix √© o tempo decorrido desde o __Unix Epoch em 1¬∫ de janeiro de 1970__. Veja aqui a [hora atual em Unix em segundos](https://www.unixtimestamp.com/pt) e aqui para mais informa√ß√µes sobre o [Tempo Unix](https://pt.wikipedia.org/wiki/Era_Unix). Um valor para o tempo Unix √© chamado de _timestamp_. __Timestamps Unix__ s√£o sempre expressos no fuso hor√°rio UTC (ou "GMT", ou "GMT+0"). Eles s√£o medidos a partir de uma refer√™ncia fixa, ou seja, o Epoch Unix, e n√£o variam com fusos hor√°rios. Algumas funcionalidades incorporadas usam o fuso hor√°rio UTC como refer√™ncia.
2. __Fuso hor√°rio da bolsa__: Uma segunda refer√™ncia de tempo importante para os traders √© o fuso hor√°rio da bolsa onde um instrumento √© negociado. Algumas funcionalidades incorporadas, como [hour](https://br.tradingview.com/pine-script-reference/v5/#var_hour), retornam valores no fuso hor√°rio da bolsa por padr√£o.
3. __Par√¢metro `timezone`__: Algumas fun√ß√µes que normalmente retornam valores no fuso hor√°rio da bolsa, como [hour()](https://br.tradingview.com/pine-script-reference/v5/#fun_hour), incluem um par√¢metro `timezone` que permite adaptar o resultado da fun√ß√£o para outro fuso hor√°rio. Outras fun√ß√µes, como [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time), incluem os par√¢metros `session` e `timezone`. Nesses casos, o argumento `timezone` se aplica a como o argumento `session` √© interpretado ‚Äî n√£o ao valor de _tempo_ retornado pela fun√ß√£o.
4. __Fuso hor√°rio do gr√°fico__: Este √© o fuso hor√°rio escolhido pelo usu√°rio no gr√°fico usando o campo "_Configura√ß√µes do Gr√°fico/S√≠mbolo/Fuso Hor√°rio_" "_Chart Settings/Symbol/Time Zone_". Esta configura√ß√£o afeta apenas a exibi√ß√£o de datas e hor√°rios no gr√°fico. N√£o afeta o comportamento dos scripts Pine, e eles n√£o t√™m visibilidade sobre essa configura√ß√£o.

Ao discutir vari√°veis ou fun√ß√µes, ser√° notado se elas retornam datas ou hor√°rios em UTC ou no fuso hor√°rio da bolsa. Scripts n√£o t√™m visibilidade sobre a configura√ß√£o de fuso hor√°rio do usu√°rio no gr√°fico.

## Fun√ß√µes e Vari√°veis Incorporadas de Tempo

Pine Script possui _vari√°veis_ "__incorporadas__" "__built-in__" para:

- Obter informa√ß√µes de timestamp da barra atual (fuso hor√°rio UTC): [time](https://br.tradingview.com/pine-script-reference/v5/#var_time) e [time_close](https://br.tradingview.com/pine-script-reference/v5/#var_time_close)
- Obter informa√ß√µes de timestamp para o in√≠cio do dia de negocia√ß√£o atual (fuso hor√°rio UTC): [time_tradingday](https://br.tradingview.com/pine-script-reference/v5/#var_time_tradingday)
- Obter o hor√°rio atual em incrementos de um segundo (fuso hor√°rio UTC): [timenow](https://br.tradingview.com/pine-script-reference/v5/#var_timenow)
- Recuperar valores de calend√°rio e tempo da barra (fuso hor√°rio da bolsa): [year](https://br.tradingview.com/pine-script-reference/v5/#var_year), [month](https://br.tradingview.com/pine-script-reference/v5/#var_month), [weekofyear](https://br.tradingview.com/pine-script-reference/v5/#var_weekofyear), [dayofmonth](https://br.tradingview.com/pine-script-reference/v5/#var_dayofmonth), [dayofweek](https://br.tradingview.com/pine-script-reference/v5/#var_dayofweek), [hour](https://br.tradingview.com/pine-script-reference/v5/#var_hour), [minute](https://br.tradingview.com/pine-script-reference/v5/#var_minute) e [second](https://br.tradingview.com/pine-script-reference/v5/#var_second)
- Retornar o fuso hor√°rio da bolsa do s√≠mbolo do gr√°fico com [syminfo.timezone](https://br.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtimezone)

Tamb√©m h√° _fun√ß√µes_ __incorporadas__ que podem:

- Retornar timestamps de barras de outros per√≠odos com [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time) e [time_close()](https://br.tradingview.com/pine-script-reference/v5/#fun_time_close), sem a necessidade de uma chamada [request.security()](https://br.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity)
- Recuperar valores de calend√°rio e tempo de qualquer timestamp, que podem ser ajustados com um fuso hor√°rio: [year()](https://br.tradingview.com/pine-script-reference/v5/#fun_year), [month()](https://br.tradingview.com/pine-script-reference/v5/#fun_month), [weekofyear()](https://br.tradingview.com/pine-script-reference/v5/#fun_weekofyear), [dayofmonth()](https://br.tradingview.com/pine-script-reference/v5/#fun_dayofmonth), [dayofweek()](https://br.tradingview.com/pine-script-reference/v5/#fun_dayofweek), [hour()](https://br.tradingview.com/pine-script-reference/v5/#fun_hour), [minute()](https://br.tradingview.com/pine-script-reference/v5/#fun_minute) e [second()](https://br.tradingview.com/pine-script-reference/v5/#fun_second)
- Criar um timestamp usando [timestamp()](https://br.tradingview.com/pine-script-reference/v5/#fun_timestamp)
- Converter um timestamp para uma string de data/hora formatada para exibi√ß√£o, usando [str.format()](https://br.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dformat)
- Inserir valores de data e hora. Veja a se√ß√£o sobre [Entradas](./05_09_inputs.md).
- Trabalhar com [informa√ß√µes de sess√£o](./05_17_sessoes.md).

## Fuso Hor√°rio

Os usu√°rios do TradingView podem alterar o fuso hor√°rio usado para exibir os hor√°rios das barras em seus gr√°ficos. Scripts Pine n√£o t√™m visibilidade sobre essa configura√ß√£o. Embora haja uma vari√°vel [syminfo.timezone](https://br.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtimezone) para retornar o fuso hor√°rio da bolsa onde o instrumento do gr√°fico √© negociado, __n√£o__ existe um equivalente `chart.timezone`.

Ao exibir hor√°rios no gr√°fico, esta √© uma maneira de fornecer aos usu√°rios um meio de ajustar os valores de tempo do seu script aos do gr√°fico deles. Dessa forma, os hor√°rios exibidos podem corresponder ao fuso hor√°rio usado pelos traders em seu gr√°fico:

![Fuso hor√°rio 01](./imgs/Time-TimeZones-01.BhZfcsQ2_BWgd3.webp)

```c
//@version=5
indicator("Time zone control")
MS_IN_1H = 1000 * 60 * 60
TOOLTIP01 = "Enter your time zone's offset (+ or ‚àí), including a decimal fraction if needed."
hoursOffsetInput = input.float(0.0, "Timezone offset (in hours)", minval = -12.0, maxval = 14.0, step = 0.5, tooltip = TOOLTIP01)

printTable(txt) => 
    var table t = table.new(position.middle_right, 1, 1)
    table.cell(t, 0, 0, txt, text_halign = text.align_right, bgcolor = color.yellow)

msOffsetInput = hoursOffsetInput * MS_IN_1H
printTable(
  str.format("Last bar''s open time UTC: {0,date,HH:mm:ss yyyy.MM.dd}", time) +
  str.format("\nLast bar''s close time UTC: {0,date,HH:mm:ss yyyy.MM.dd}", time_close) +
  str.format("\n\nLast bar''s open time EXCHANGE: {0,date,HH:mm:ss yyyy.MM.dd}", time(timeframe.period, syminfo.session, syminfo.timezone)) +
  str.format("\nLast bar''s close time EXCHANGE: {0,date,HH:mm:ss yyyy.MM.dd}", time_close(timeframe.period, syminfo.session, syminfo.timezone)) +
  str.format("\n\nLast bar''s open time OFFSET ({0}): {1,date,HH:mm:ss yyyy.MM.dd}", hoursOffsetInput, time + msOffsetInput) +
  str.format("\nLast bar''s close time OFFSET ({0}): {1,date,HH:mm:ss yyyy.MM.dd}", hoursOffsetInput, time_close + msOffsetInput) +
  str.format("\n\nCurrent time OFFSET ({0}): {1,date,HH:mm:ss yyyy.MM.dd}", hoursOffsetInput, timenow + msOffsetInput))
```

__Note que:__

- Converte-se o deslocamento do usu√°rio expresso em horas para milissegundos com `msOffsetInput`. Em seguida, adiciona-se esse deslocamento a um timestamp em formato UTC antes de convert√™-lo para o formato de exibi√ß√£o, por exemplo, `time + msOffsetInput` e `timenow + msOffsetInput`.
- Utiliza-se um `tooltip` para fornecer _instru√ß√µes_ aos usu√°rios.
- Fornecem-se valores `minval` e `maxval` para proteger o campo de entrada e um valor `step` de 0,5 para que, quando utilizarem as setas para cima/baixo do campo, possam entender intuitivamente que fra√ß√µes podem ser usadas.
- A fun√ß√£o [str.format()](https://br.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dformat) formata os valores de tempo, nomeadamente o hor√°rio da √∫ltima barra e o hor√°rio atual.

Algumas fun√ß√µes que normalmente retornam valores no fuso hor√°rio da bolsa fornecem meios para adaptar o resultado a outro fuso hor√°rio por meio do par√¢metro `timezone`. Este script ilustra como fazer isso com [hour()](https://br.tradingview.com/pine-script-reference/v5/#fun_hour):

![Fuso hor√°rio 02](./imgs/Time-TimeZones-02.xptlcK0i_1VVd7u.webp)

```c
//@version=5
indicator('`hour(time, "GMT+0")` in orange')
color BLUE_LIGHT = #0000FF30
plot(hour, "", BLUE_LIGHT, 8)
plot(hour(time, syminfo.timezone))
plot(hour(time, "GMT+0"),"UTC", color.orange)
```

__Note que:__

- A vari√°vel [hour](https://br.tradingview.com/pine-script-reference/v5/#var_hour) e a fun√ß√£o [hour()](https://br.tradingview.com/pine-script-reference/v5/#fun_hour) normalmente retornam um valor no fuso hor√°rio da bolsa. Assim, os plots em azul para `hour` e `hour(time, syminfo.timezone)` se sobrep√µem. Usar a forma de fun√ß√£o com `syminfo.timezone` √© redundante se a hora da bolsa for necess√°ria.
- A linha laranja plotando `hour(time, "GMT+0")`, no entanto, retorna a hora da barra em UTC, ou hor√°rio "GMT+0", que neste caso √© quatro horas a menos que a hora da bolsa, j√° que a MSFT √© negociada na NASDAQ, cujo fuso hor√°rio √© UTC-4.

### Strings de Fuso Hor√°rio

O argumento usado para o par√¢metro `timezone` em fun√ß√µes como [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time), [timestamp()](https://br.tradingview.com/pine-script-reference/v5/#fun_timestamp), [hour()](https://br.tradingview.com/pine-script-reference/v5/#fun_hour), etc., pode estar em diferentes formatos, que podem ser encontrados na p√°gina de refer√™ncia [IANA time zone database name](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones). Os conte√∫dos das colunas "TZ database name", "UTC offset ¬±hh:mm" e "UTC DST offset ¬±hh:mm" da tabela dessa p√°gina podem ser usados.

Para expressar um deslocamento de +5,5 horas a partir do UTC, essas strings encontradas na p√°gina de refer√™ncia s√£o todas equivalentes:

- `"GMT+05:30"`
- `"Asia/Calcutta"`
- `"Asia/Colombo"`
- `"Asia/Kolkata"`

Deslocamentos "_n√£o-fracion√°rios_" "_non-fractional_" podem ser expressos na forma `"GMT+5"`. `"GMT+5.5"` n√£o √© permitido.

## Vari√°veis de Tempo

### `time` e `time_close`

O plot de [time](https://br.tradingview.com/pine-script-reference/v5/#var_time) e [time_close](https://br.tradingview.com/pine-script-reference/v5/#var_time_close), o timestamp Unix em milissegundos do hor√°rio de abertura e fechamento da barra:

![Time e time_close](./imgs/Time-TimeAndTimeclose-01.Db16O5Ht_ZGCjBm.webp)

```c
//@version=5
indicator("`time` and `time_close` values on bars")
plot(time, "`time`")
plot(time_close, "`time_close`")
```

__Note que:__

- As vari√°veis [time](https://br.tradingview.com/pine-script-reference/v5/#var_time) e [time_close](https://br.tradingview.com/pine-script-reference/v5/#var_time_close) retornam um timestamp em [UNIX time](https://en.wikipedia.org/wiki/Unix_time), que √© independente do fuso hor√°rio selecionado pelo usu√°rio no gr√°fico. Neste caso, a configura√ß√£o de fuso hor√°rio do __gr√°fico__ √© o fuso hor√°rio da bolsa, ent√£o, qualquer que seja o s√≠mbolo no gr√°fico, o fuso hor√°rio da bolsa ser√° usado para exibir os valores de data e hora no cursor do gr√°fico. O fuso hor√°rio da NASDAQ √© UTC-4, mas isso afeta apenas a exibi√ß√£o de valores de data/hora no gr√°fico; n√£o impacta os valores plotados pelo script.
- O √∫ltimo valor de [time](https://br.tradingview.com/pine-script-reference/v5/#var_time) para o plot mostrado na escala √© o n√∫mero de milissegundos decorridos desde 00:00:00 UTC de 1¬∫ de janeiro de 1970 at√© o hor√°rio de abertura da barra. Corresponde √†s 17:30 do dia 27 de setembro de 2021. No entanto, como o gr√°fico usa o fuso hor√°rio UTC-4 (o fuso hor√°rio da NASDAQ), exibe o hor√°rio 13:30, quatro horas antes do hor√°rio UTC.
- A diferen√ßa entre os dois valores na √∫ltima barra √© o n√∫mero de milissegundos em uma hora (1000 * 60 * 60 = 3.600.000) por ser um gr√°fico de 1H.

### `time_tradingday`

A vari√°vel [time_tradingday](https://br.tradingview.com/pine-script-reference/v5/#var_time_tradingday) √© √∫til quando um s√≠mbolo √© negociado em sess√µes noturnas que come√ßam e terminam em dias de calend√°rio diferentes. Por exemplo, isso acontece nos mercados forex, onde uma sess√£o pode abrir no domingo √†s 17:00 e fechar na segunda-feira √†s 17:00.

A vari√°vel retorna o hor√°rio de in√≠cio do dia de negocia√ß√£o em [tempo UNIX](https://pt.wikipedia.org/wiki/Era_Unix) quando usada em _timeframes_ de 1D ou menos. Quando usada em _timeframes_ superiores a 1D, retorna o hor√°rio de in√≠cio do √∫ltimo dia de negocia√ß√£o na barra (por exemplo, em 1W, retornar√° o hor√°rio de in√≠cio do √∫ltimo dia de negocia√ß√£o da semana).

### `timenow`

O [timenow](https://br.tradingview.com/pine-script-reference/v5/#var_timenow) retorna a hora atual em [tempo UNIX](https://pt.wikipedia.org/wiki/Era_Unix). Funciona em tempo real, mas tamb√©m quando um script √© executado em barras hist√≥ricas. Em tempo real, seus scripts perceber√£o mudan√ßas apenas quando forem executados em atualiza√ß√µes de feed. Quando n√£o ocorrem atualiza√ß√µes, o script fica inativo, portanto, n√£o pode atualizar sua exibi√ß√£o. Veja a p√°gina sobre o [modelo de execu√ß√£o](./04_01_modelo_de_execucao.md) do Pine Script para mais informa√ß√µes.

Este script usa os valores de [timenow](https://br.tradingview.com/pine-script-reference/v5/#var_timenow) e [time_close](https://br.tradingview.com/pine-script-reference/v5/#var_time_close) para calcular uma contagem regressiva em tempo real para barras intradi√°rias. Ao contr√°rio da contagem regressiva no gr√°fico, esta s√≥ ser√° atualizada quando uma atualiza√ß√£o de feed causar a execu√ß√£o de outra itera√ß√£o do script:

```c
//@version=5
indicator("", "", true)

printTable(txt) => 
    var table t = table.new(position.middle_right, 1, 1)
    table.cell(t, 0, 0, txt, text_halign = text.align_right, bgcolor = color.yellow)

printTable(str.format("{0,time,HH:mm:ss.SSS}", time_close - timenow))
```

### Vari√°veis de Datas e Hor√°rios do Calend√°rio

Vari√°veis de data e hora do calend√°rio, como [year](https://br.tradingview.com/pine-script-reference/v5/#var_year), [month](https://br.tradingview.com/pine-script-reference/v5/#var_month), [weekofyear](https://br.tradingview.com/pine-script-reference/v5/#var_weekofyear), [dayofmonth](https://br.tradingview.com/pine-script-reference/v5/#var_dayofmonth), [dayofweek](https://br.tradingview.com/pine-script-reference/v5/#var_dayofweek), [hour](https://br.tradingview.com/pine-script-reference/v5/#var_hour), [minute](https://br.tradingview.com/pine-script-reference/v5/#var_minute) e [second](https://br.tradingview.com/pine-script-reference/v5/#var_second) podem ser √∫teis para testar datas ou hor√°rios espec√≠ficos e como argumentos para [timestamp()](https://br.tradingview.com/pine-script-reference/v5/#fun_timestamp).

Ao testar datas ou hor√°rios espec√≠ficos, √© necess√°rio considerar a possibilidade de o script ser executado em _timeframes_ onde a condi√ß√£o testada n√£o pode ser detectada ou para casos em que uma barra com o requisito espec√≠fico n√£o existir√°. Suponha, por exemplo, que se deseje detectar o primeiro dia de negocia√ß√£o do m√™s. Este script mostra como usar apenas [dayofmonth](https://br.tradingview.com/pine-script-reference/v5/#var_dayofmonth) n√£o funcionar√° quando um gr√°fico semanal for usado ou quando n√£o houver negocia√ß√£o no primeiro dia do m√™s:

![Vari√°veis de datas e hor√°rios do calend√°rio](./imgs/Time-CalendarDatesAndTimes-01.CsQOdc6g_Z2aBm8f.webp)

```c
//@version=5
indicator("", "", true)
firstDayIncorrect = dayofmonth == 1
firstDay = ta.change(time("M"))
plotchar(firstDayIncorrect, "firstDayIncorrect", "‚Ä¢", location.top, size = size.small)
bgcolor(firstDay ? color.silver : na)
```

__Note que:__

- Usar `ta.change(time("M"))` √© mais robusto, pois funciona em todos os meses (#1 e #2), exibidos como o fundo prateado, enquanto o ponto azul detectado usando `dayofmonth == 1` n√£o funciona (#1) quando o primeiro dia de negocia√ß√£o de setembro ocorre no dia 2.
- A condi√ß√£o `dayofmonth == 1` ser√° `true` em todas as barras do primeiro dia do m√™s, mas `ta.change(time("M"))` ser√° `true` apenas na primeira.

Se quiser que o script seja exibido apenas para os anos de 2020 em diante, pode usar:

```c
//@version=5
indicator("", "", true)
plot(year >= 2020 ? close : na, linewidth = 3)
```

### `syminfo.timezone()`

O [syminfo.timezone](https://br.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtimezone) retorna o fuso hor√°rio da bolsa do s√≠mbolo do gr√°fico. Pode ser √∫til quando um par√¢metro `timezone` est√° dispon√≠vel em uma fun√ß√£o e deseja-se mencionar que est√° usando explicitamente o fuso hor√°rio da bolsa. Geralmente √© redundante, pois quando nenhum argumento √© fornecido para `timezone`, assume-se o fuso hor√°rio da bolsa.

## Fun√ß√µes de Tempo

### `time()` e `time_close()`

As fun√ß√µes [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time) e [time_close()](https://br.tradingview.com/pine-script-reference/v5/#fun_time_close) t√™m a seguinte assinatura:

```c
time(timeframe, session, timezone) ‚Üí series int
time_close(timeframe, session, timezone) ‚Üí series int
```

Tr√™s __argumentos__ aceitos:

##### `timeframe`

Uma string no formato [timeframe.period](https://br.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dperiod).

##### `session`

Uma string opcional no formato de especifica√ß√£o de sess√£o: `"hhmm-hhmm[:days]"`, onde a parte `[:days]` √© opcional. Veja a p√°gina sobre [sess√µes](./05_17_sessoes.md) para mais informa√ß√µes.

##### `timezone`

Um valor opcional que qualifica o argumento para `session` quando um √© usado.

Veja as entradas de [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time) e [time_close()](https://br.tradingview.com/pine-script-reference/v5/#fun_time_close) no Manual de Refer√™ncia para mais informa√ß√µes.

A fun√ß√£o [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time) √© mais frequentemente usada para:

1. Testar se uma barra est√° em um per√≠odo de tempo espec√≠fico, o que exigir√° o uso do par√¢metro `session`. Nesses casos, `timeframe.period`, ou seja, o per√≠odo do gr√°fico, ser√° frequentemente usado para o primeiro par√¢metro. Ao usar a fun√ß√£o dessa maneira, confia-se no fato de que ela retornar√° [na](https://br.tradingview.com/pine-script-reference/v5/#var_na) quando a barra n√£o fizer parte do per√≠odo especificado no argumento `session`.
2. Detectar mudan√ßas em per√≠odos de tempo superiores ao do gr√°fico, usando o per√≠odo de tempo superior para o argumento `timeframe`. Ao usar a fun√ß√£o para esse prop√≥sito, procura-se mudan√ßas no valor retornado, o que significa que a barra de per√≠odo superior mudou. Isso geralmente exigir√° o uso de [ta.change()](https://br.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dchange) para testar, por exemplo, `ta.change(time("D"))` retornar√° a mudan√ßa no tempo quando uma nova barra de per√≠odo superior entrar, ent√£o o resultado da express√£o ser√° convertido em um valor "bool" quando usado em uma express√£o condicional. O resultado "bool" ser√° `true` quando houver uma mudan√ßa e `false` quando n√£o houver mudan√ßa.

#### Testando Sess√µes

Um exemplo do primeiro caso √© determinar se o hor√°rio de in√≠cio de uma barra faz parte de um per√≠odo entre 11:00 e 13:00:

![Testando sess√µes](./imgs/Time-Time()AndTimeclose()-01.D7rt1wV__1zldez.webp)

```c
//@version=5
indicator("Session bars", "", true)
inSession = not na(time(timeframe.period, "1100-1300"))
bgcolor(inSession ? color.silver : na)
```

__Note que:__

- `time(timeframe.period, "1100-1300")` verifica se o per√≠odo do gr√°fico inclui o hor√°rio de abertura da barra entre 11:00 e 13:00, inclusive. A fun√ß√£o retorna o hor√°rio de abertura se a barra estiver na sess√£o. Se __n√£o__ estiver, a fun√ß√£o retorna [na](https://br.tradingview.com/pine-script-reference/v5/#var_na).
- Interessa-se em identificar os casos quando [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time) n√£o retorna [na](https://br.tradingview.com/pine-script-reference/v5/#var_na), pois isso significa que a barra est√° na sess√£o, ent√£o testa-se `not na(...)`. O valor de retorno real de [time()](https://br.tradingview.com/pine-script-reference/v5/#fun_time) quando n√£o √© [na](https://br.tradingview.com/pine-script-reference/v5/#var_na) n√£o √© utilizado; interessa-se apenas se retorna [na](https://br.tradingview.com/pine-script-reference/v5/#var_na) ou n√£o.

#### Testando Mudan√ßas em _Timeframes_ Maiores

Muitas vezes, √© √∫til detectar mudan√ßas em um _timeframe_ maior. Por exemplo, pode-se querer detectar mudan√ßas no dia de negocia√ß√£o enquanto est√° em gr√°ficos intradi√°rios. Nesses casos, pode-se usar o fato de que `time("D")` retorna o hor√°rio de abertura da barra de 1D, mesmo que o gr√°fico esteja em um _timeframe_ intradi√°rio, como 1H:

![Testando mudan√ßas em timeframes maiores](./imgs/Time-TestingForChangesInHTF-01.Dfuq4jRU_2pdjFq.webp)

```c
//@version=5
indicator("", "", true)
bool newDay = ta.change(time("D"))
bgcolor(newDay ? color.silver : na)

newExchangeDay = ta.change(dayofmonth)
plotchar(newExchangeDay, "newExchangeDay", "ü†á", location.top, size = size.small)
```

__Note que:__

- A vari√°vel `newDay` detecta mudan√ßas no hor√°rio de abertura de barras de 1D, seguindo as conven√ß√µes para o s√≠mbolo do gr√°fico, que usa sess√µes noturnas das 17:00 √†s 17:00. Muda de valor quando uma nova sess√£o come√ßa.
- Como `newExchangeDay` detecta mudan√ßas no [dayofmonth](https://br.tradingview.com/pine-script-reference/v5/#var_dayofmonth) do dia do calend√°rio, ele muda quando o dia muda no gr√°fico.
- Os dois m√©todos de detec√ß√£o de mudan√ßas s√≥ coincidem no gr√°fico quando h√° dias sem negocia√ß√£o. Nos domingos, por exemplo, ambos os m√©todos de detec√ß√£o identificar√£o uma mudan√ßa, pois o dia do calend√°rio muda do √∫ltimo dia de negocia√ß√£o (sexta-feira) para o primeiro dia do calend√°rio da nova semana, domingo, que √© quando a sess√£o noturna de segunda-feira come√ßa √†s 17:00.

<!-- ### Fun√ß√µes de Datas e Hor√°rios do Calend√°rio

Fun√ß√µes de data e hora do calend√°rio, como [year()](https://br.tradingview.com/pine-script-reference/v5/#fun_year), [month()](https://br.tradingview.com/pine-script-reference/v5/#fun_month), [weekofyear()](https://br.tradingview.com/pine-script-reference/v5/#fun_weekofyear), [dayofmonth()](https://br.tradingview.com/pine-script-reference/v5/#fun_dayofmonth), [dayofweek()](https://br.tradingview.com/pine-script-reference/v5/#fun_dayofweek), [hour()](https://br.tradingview.com/pine-script-reference/v5/#fun_hour), [minute()](https://br.tradingview.com/pine-script-reference/v5/#fun_minute) e [second()](https://br.tradingview.com/pine-script-reference/v5/#fun_second) podem ser √∫teis para testar datas ou hor√°rios espec√≠ficos. Possuem assinatures semelhantes ao [dayofmonth()](https://br.tradingview.com/pine-script-reference/v5/#fun_dayofmonth):

```c
dayofmonth(time) ‚Üí series int
dayofmonth(time, timezone) ‚Üí series int
```

Isso ir√° plotar o dia de abertura da barra onde o tempo 1¬∫ de janeiro de 2021 √†s 00:00 cai entre seus valores [time](https://br.tradingview.com/pine-script-reference/v5/#var_time) e [time_close](https://br.tradingview.com/pine-script-reference/v5/#var_time_close):

```c
//@version=5
indicator("")
exchangeDay = dayofmonth(timestamp("2021-01-01"))
plot(exchangeDay)
```

O valor ser√° o dia 31 ou o dia 1, dependendo do dia do calend√°rio em que a sess√£o abre no s√≠mbolo do gr√°fico. A data para s√≠mbolos negociados 24x7 em bolsas usando o fuso hor√°rio UTC ser√° o dia 1. Para s√≠mbolos negociados em bolsas no fuso hor√°rio UTC-4, a data ser√° o dia 31.

### `timestamp()`

A fun√ß√£o [timestamp()](https://br.tradingview.com/pine-script-reference/v5/#fun_timestamp) possui algumas assinaturas diferentes:

```c
timestamp(year, month, day, hour, minute, second) ‚Üí simple/series int
timestamp(timezone, year, month, day, hour, minute, second) ‚Üí simple/series int
timestamp(dateString) ‚Üí const int
```

A √∫nica diferen√ßa entre os dois primeiros √© o par√¢metro `timezone`. Seu valor padr√£o √© [syminfo.timezone](https://br.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtimezone). Consulte a se√ß√£o [Strings de Fuso Hor√°rio](./05_21_time.md#strings-de-fuso-hor√°rio) desta p√°gina para valores v√°lidos.

A terceira forma √© usada como um valor `defval` em [input.time()](https://br.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dtime). Consulte a entrada [timestamp()](https://br.tradingview.com/pine-script-reference/v5/#fun_timestamp) no Manual de Refer√™ncia para mais informa√ß√µes.

[timestamp()](https://br.tradingview.com/pine-script-reference/v5/#fun_timestamp) √© √∫til para gerar um timestamp para uma data espec√≠fica. Para gerar um timestamp para 1¬∫ de janeiro de 2021, use qualquer um destes m√©todos:

```c
//@version=5
indicator("")
yearBeginning1 = timestamp("2021-01-01")
yearBeginning2 = timestamp(2021, 1, 1, 0, 0)
printTable(txt) => var table t = table.new(position.middle_right, 1, 1), table.cell(t, 0, 0, txt, bgcolor = color.yellow)
printTable(str.format("yearBeginning1: {0,date,yyyy.MM.dd hh:mm}\nyearBeginning2: {1,date,yyyy.MM.dd hh:mm}", yearBeginning1, yearBeginning1))
```

Deslocamentos podem ser usados nos argumentos de [timestamp()](https://br.tradingview.com/pine-script-reference/v5/#fun_timestamp). Aqui, subtrai-se 2 do valor fornecido para seu par√¢metro `day` para obter a data/hora da √∫ltima barra do gr√°fico h√° dois dias. Observe que, devido aos diferentes alinhamentos de barras em v√°rios instrumentos, a barra identificada no gr√°fico pode n√£o estar exatamente a 48 horas de dist√¢ncia, embora o valor retornado pela fun√ß√£o esteja correto:

```c
//@version=5
indicator("")
twoDaysAgo = timestamp(year, month, dayofmonth - 2, hour, minute)
printTable(txt) => var table t = table.new(position.middle_right, 1, 1), table.cell(t, 0, 0, txt, bgcolor = color.yellow)
printTable(str.format("{0,date,yyyy.MM.dd hh:mm}", twoDaysAgo))
```

## Formata√ß√£o de Datas e Horas

Timestamps podem ser formatados usando [str.format()](https://br.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dformat). Estes s√£o exemplos de v√°rios formatos:

![Formata√ß√£o de Datas e Horas](./imgs/Time-FormattingDatesAndTime-01.C3KF2qwQ_Z1A6rFf.webp)

```c
//@version=5
indicator("", "", true)

print(txt, styl) => 
    var alignment = styl == label.style_label_right ? text.align_right : text.align_left
    var lbl = label.new(na, na, "", xloc.bar_index, yloc.price, color(na), styl, color.black, size.large, alignment)
    if barstate.islast
        label.set_xy(lbl, bar_index, hl2[1])
        label.set_text(lbl, txt)

var string format = 
  "{0,date,yyyy.MM.dd hh:mm:ss}\n" +
  "{1,date,short}\n" +
  "{2,date,medium}\n" +
  "{3,date,long}\n" +
  "{4,date,full}\n" +
  "{5,date,h a z (zzzz)}\n" +
  "{6,time,short}\n" +
  "{7,time,medium}\n" +
  "{8,date,'Month 'MM, 'Week' ww, 'Day 'DD}\n" +
  "{9,time,full}\n" + 
  "{10,time,hh:mm:ss}\n" +
  "{11,time,HH:mm:ss}\n" +
  "{12,time,HH:mm:ss} Left in bar\n"

print(format, label.style_label_right)
print(str.format(format,
  time, time, time, time, time, time, time, 
  timenow, timenow, timenow, timenow, 
  timenow - time, time_close - timenow), label.style_label_left)
``` -->
