
# Séries Temporais

Grande parte da potência do Pine Script deriva do fato de que foi projetado para processar _séries temporais_ de forma eficiente. Séries temporais não são um tipo qualificado; são a estrutura fundamental que o Pine Script usa para armazenar os valores sucessivos de uma variável ao longo do tempo, onde cada valor está vinculado a um ponto no tempo. Como os gráficos são compostos por barras, cada uma representando um ponto específico no tempo, série temporal é a estrutura de dados ideal para trabalhar com valores que podem mudar com o tempo.

A noção de séries temporais está intimamente ligada ao [modelo de execução](./04_01_modelo_de_execucao.md) e aos conceitos de [tipagem](./000_type_system.md) do Pine Script. Compreender os três é fundamental para aproveitar ao máximo o poder do Pine Script.

Considere a variável embutida [open](https://br.tradingview.com/pine-script-reference/v5/#var_open), que contém o preço de "abertura" de cada barra no conjunto de dados, o _conjunto de dados_ sendo todas as barras em qualquer gráfico específico. Se o seu script estiver sendo executado em um gráfico de 5 minutos, então cada valor na série temporal de [open](https://br.tradingview.com/pine-script-reference/v5/#var_open) é o preço de "abertura" das barras consecutivas de 5 minutos do gráfico. Quando seu script se refere a [open](https://br.tradingview.com/pine-script-reference/v5/#var_open), está se referindo ao preço de "abertura" da barra em que o script está sendo executado. Para se referir a valores passados em uma série temporal, usa-se o operador de referência histórico [[]](https://br.tradingview.com/pine-script-reference/v5/#op_[]). Quando um script está sendo executado em uma barra específica, `open[1]` se refere ao valor da série temporal de [open](https://br.tradingview.com/pine-script-reference/v5/#var_open) na barra anterior.

Embora séries temporais possam lembrar os programadores de arrays, porém são completamente diferentes. O Pine Script utiliza uma estrutura de dados de array, mas é um conceito totalmente diferente de uma série temporal.

As séries temporais no Pine Script, combinadas com seu tipo especial de mecanismo de execução e funções integradas, são o que torna fácil calcular o total cumulativo dos valores de [close](https://br.tradingview.com/pine-script-reference/v5/#var_close) sem usar o [for](https://br.tradingview.com/pine-script-reference/v5/#op_for) loop, apenas com `ta.cum(close)`. Isso é possível pelo motivo que, embora `ta.cum(close)` pareça bastante estático em um script, na verdade é executado em cada barra, então seu valor se torna cada vez maior à medida que o valor de [close](https://br.tradingview.com/pine-script-reference/v5/#var_close) de cada nova barra é adicionado. Quando o script alcança a barra mais atual do gráfico, `ta.cum(close)` retorna a soma do valor de [close](https://br.tradingview.com/pine-script-reference/v5/#var_close) de todas as barras no gráfico.

Da mesma forma, a média da diferença entre os últimos 14 valores de [high](https://br.tradingview.com/pine-script-reference/v5/#var_high) e [low](https://br.tradingview.com/pine-script-reference/v5/#var_low) pode ser expressada como `ta.sma(high - low, 14)`, ou a distância em barras desde a última vez que o gráfico fez cinco altas consecutivas mais altas como `barssince(rising(high, 5))`.

Até mesmo o resultado das chamadas de função em barras sucessivas deixa rastro de valores em uma série temporal que pode ser referenciada usando o operador de referência histórico [[]](https://br.tradingview.com/pine-script-reference/v5/#op_[]). Isso pode ser útil, por exemplo, ao testar o valor [close](https://br.tradingview.com/pine-script-reference/v5/#var_close) da barra atual para uma suposta _violação_ (_breach_) do valor da maior [high](https://br.tradingview.com/pine-script-reference/v5/#var_high) nas últimas 10 barras, mas excluindo a barra atual, o que poderíamos escrever como `breach = close > highest(close, 10)[1]`. A mesma afirmação pode ser escrita como `breach = close > highest(close[1], 10)`.

A mesma lógica de iteração (_looping_) em todas as barras é aplicada para chamadas de função como `plot(open)`, que iterará em cada barra, plotando sucessivamente no gráfico o valor de [open](https://br.tradingview.com/pine-script-reference/v5/#var_open) para cada barra.

Não confunda "séries temporais" com o qualificador "séries" (_series_). O conceito de _séries temporais_ explica como os valores consecutivos das variáveis são armazenados no Pine Script; o qualificador "série" (_serie_) indica variáveis cujos valores podem mudar de barra para barra. Considere, por exemplo, a variável integrada [timeframe.period](https://br.tradingview.com/pine-script-reference/v5/#var_timeframe{dot}period), que tem o qualificador "simples" (_simple_) e o tipo "string", significando que é do tipo qualificado "string simples" (_string simple_). O qualificador "simples" implica que o valor da variável é estabelecido na barra zero (a primeira barra onde o script é executado) e não mudará durante a execução do script em nenhuma das barras do gráfico.

O valor da variável é o intervalo de tempo do gráfico em formato de string, então `"D"` para um gráfico de 1D, por exemplo. Mesmo que seu valor não possa alterar durante o script, seria sintaticamente (de acordo com as regras de sintaxe) correto em Pine Script (embora não muito útil) referir-se ao seu valor de 10 barras atrás usando `timeframe.period[10]`. Isso é possível porque os valores sucessivos de [timeframe.period](https://br.tradingview.com/pine-script-reference/v5/#var_timeframe{dot}period) para cada barra são armazenados numa série temporal, mesmo que todos os valores nessa série temporal particularmente sejam iguais. No entanto, observe que quando o operador [[]](https://br.tradingview.com/pine-script-reference/v5/#op_[]) é utilizado para acessar valores passados de uma variável, o mesmo produz um valor qualificado como "_serie_", mesmo quando a variável sem um deslocamento usa um qualificador diferente, como "_simple_" no caso de [timeframe.period](https://br.tradingview.com/pine-script-reference/v5/#var_timeframe{dot}period), ou seja, o operador [[]](https://br.tradingview.com/pine-script-reference/v5/#op_[]) é utilizado para acessar valores passados de uma variável em uma série temporal. Mesmo que uma variável como [timeframe.period](https://br.tradingview.com/pine-script-reference/v5/#var_timeframe{dot}period) seja qualificada como "_simple_" e seu valor não mude ao longo do script, ao usar [[]](https://br.tradingview.com/pine-script-reference/v5/#op_[]) para acessar valores passados, o valor retornado será qualificado como "_series_". Isso ocorre porque o operador [[]](https://br.tradingview.com/pine-script-reference/v5/#op_[]) cria uma série temporal das diferentes instâncias da variável ao longo do tempo, mesmo que todas as instâncias tenham o mesmo valor.

Ao entender como as séries temporais podem ser eficientemente manipuladas usando a sintaxe do Pine Script e seu [modelo de execução](./04_01_modelo_de_execucao.md), pode-se então definir cálculos complexos usando poucas linhas de código.
